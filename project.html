<!-- 
Francys Scott and Susie Carovillano
November 2014
CS 307
project.html

Update the description below

Creates a room with a a ball, umbrella, table with lathed legs, teapot, and a window
with the sounds and view of a rainy day. (Note: Textures make take a little 
while to properly load and render.)

Manipulate the sceneParams to change the scene's details.
Details available to change:
	room's size;
	wall, ceiling, and floor textures;
	window's width and frame color;
	ball's color, radius, shininess, and specular light interactions;
	table's height, width, color, texture, and shininess;
	umbrella canopy's color, size, texture, shininess, and specular light interactions;
	umbrella handle's color;
	teapot's size, shininess, and ambient, diffuse, and specular light interactions;
	slide's height, length, color and lighting;
	ramp's height, length, color and lighting;
	marble's size, color and animation parameters;
	ambient light's color;
	and directional light's color.
	
 -->

<html>
  <head>
    <title>CS307 Final</title>
    <style>      
      canvas {
          display: block;
          margin: 10px auto;
          width: 800px;
          height: 500px;
      }
    </style>
    <script src="http://cs.wellesley.edu/~cs307/threejs/libs/three.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/libs/OrbitControls.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/libs/tw.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/libs/dat.gui.min.js"></script>
    <!-- Personal scripts with our helper methods for various objects. -->
    <script src="createBall.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/fscottRoom.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/fscottTable.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/scarovilUmbrella.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/fscott_scarovilWindow.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/scarovil_fscottTeapot.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/sbailinPenguinFIXED.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/createRocket.js"></script>
    <script src="http://cs.wellesley.edu/~cs307/threejs/contrib/appleTreecyang4rscanlon.js"></script>
    <script src="scarovilShinyBall.js"></script>
    <script src="Chandelier.js"></script>
	<script src="block.js"></script>
    <script src="fscott_scarovilSlide.js"></script>
    <script src="shelf.js"></script>
    <script src="drawScene.js"></script>

  </head>
  <body>

  <script id="prog">

  //global variables for animation
  var scene = new THREE.Scene(); 
  var renderer = new THREE.WebGLRenderer();
  var marble;
  var marbleCam; 
  
  TW.mainInit(renderer,scene);

  TW.makeColor = function(r,g,b) {
    // Input values are in 0-1; return value is a 24-bit number
    // to determine the hex code, just do val.toString(16).
    // You might have to add a leading zero.
    function unsignedByte(p) {
        if( 0 <= p && p <= 1 ) {
            return Math.round(p*255);
        }
        throw "primary not in [0,1]";
    }

    var intValue = 256*256*unsignedByte(r) + 256*unsignedByte(g) + unsignedByte(b);
    var hexString = intValue.toString(16);
    console.log("r: "+r+" g: "+g+" b: "+b+" hexString: 0x"+hexString+" int: "+intValue);
    return intValue;
  };

  var sceneParams = { roomH : 200,
					wallTexture: "../images/beige_wallpaper.jpg",
					ceilingTexture: "../images/wood-pattern.jpg",
					floorTexture: "../images/wood-pattern.jpg",
					//window
					windowWidth: 150,
					windowframeColor: 0x5E2612,
					windowVideo: "../videos/Gentlerain.ogv",
					//ball
					ballColor: 0xBB33FF,
					ballRad: 6,
                    ballSpecular: 0x444444,
                    ballShininess: 20,
                    //table
                    tableHeight: 50,
                    tableWidth: 90,
                    tableColor: 0x835930,
                    tableTexture: '../images/dark-wood.jpg',
                    tableShininess: 10,
                    //umbrella
                    umbrellaColor: 0x524CFD,
                    umbrellaSpecular: 0x444444,
                    umbrellaShininess: 5,
                    umbrellaSize: 35,
                    umbrellaTexture: '../images/stripes.jpg',
                    handleColor: 0x663300,
                    //chandelier  
					chandelierHeight: 42,
					chandelierNumBranches: 4,
					chandelierIsLipped:  true,
					chandelierGlassColor: 0xFF8800,
					chandelierMetalColor: 0x5C3317,
					chandelierMetalShininess: 15,
                    //block
                    blockColor: 0xFFFFFF,
                    blockSpecular: 0x333333,
                    blockShininess: 1,
                    blockSize: 10,
                    blockTexture: '../images/ivory-wood.jpg',
                    //teapot
                    teapotAmbient: TW.makeColor(0.135, 0.2225, 0.1575), //values are for jade
                    teapotDiffuse: TW.makeColor(0.54, 0.89, 0.63), //from OpenGL/VRML Materials
                    teapotSpecular: TW.makeColor(0.316228, 0.316228, 0.316228),
                    teapotShininess: 128 * 0.1,
                    teapotSize: 5,
                    //small slide
                    slideHeight: 30,
                    slideLength: 40,
                    slideWidth: 5,
                    slideColor: 0xFFAA00,
                    slideShininess: 10,
                    slideLip: true,
                    //ramp
                    rampHeight: 50,
                    rampLength: 80,
                    rampWidth: 20,
                    rampColor: 0xFF8844,
                    rampShininess: 20,
                    rampLip: false,
                    //bowling ball
                    marbleRadius: 12,
    				marbleColor: 0x524CFD,
    				marbleSpecular: 0x444444,
                    marbleShininess: 20,
    				marbleVelocityX: 0.8,
    				marbleVelocityZ: 0.4,
    				marbleInitialX: 0,
    				marbleInitialY: 50,
    				marbleInitialZ: -140,
    				marbleAngularVelocity: TW.degrees2radians(3),
    				marbleInitialAngle: -Math.PI/4,
    				//shelves
    				shelfColor: 0xDDDDDD,
    				shelfSpecular: 0x333333,
    				shelfShininess: 3,
    				shelfHeight: 12,
    				shelfWidth: 30,
    				shelfLength: 100,
    				shelfTexture: '../images/dark-wood.jpg',
    				// toy rocket
    				toyRocketBodyColor:  0x0088FF,
    				toyRocketNoseColor:  0xFF4444,
    				toyRocketFinColor:  0xFF00FF,
    				toyRocketThrusterColor:  0xFF8800,
    				toyRocketCabinColor:  0x0000FF,
    				//toy apple
    				appleHeight: 20,
                    //lights
                    ambLightColor: 0x6F6F6F,
                    dirLightColor: 0xAAAAAA,
                    //animation
       				deltaT: 0.5,        // time between steps, in arbitrary time units
                    lastElement : null
                  };

  var animationState = {
        marbleAngle: sceneParams.marbleInitialAngle,
        marbleX: sceneParams.marbleInitialX,
        marbleY: sceneParams.marbleInitialY,
        marbleZ: sceneParams.marbleInitialZ,
        time: 0,
        lastParam: null
    };

  // Light section:  add lights as appropriate

  //create ambient light
  var ambLight = new THREE.AmbientLight( sceneParams.ambLightColor); // soft white light 
  ambLight.name = "ambient";
  scene.add( ambLight );

  // create directional light
  var dirlight = new THREE.DirectionalLight( sceneParams.dirLightColor );
  dirlight.position.set(5,5,8);
  ambLight.name = "directional";
  scene.add(dirlight);

  // create directional light from window
  var dirlight2 = new THREE.DirectionalLight( sceneParams.dirLightColor );
  dirlight2.position.set(-5,2,-4);
  dirlight2.name = "directional2";
  scene.add(dirlight2);

  // Finish camera and place scene on view.
  var state = TW.cameraSetup(renderer,
					   scene,
					   {minx: -(sceneParams.roomH * 1.5)/2, 
						  maxx: (sceneParams.roomH * 1.5)/2,
						miny: 0, maxy: sceneParams.roomH,
						minz: -(sceneParams.roomH * 1.5)/2,
						  maxz: (sceneParams.roomH * 1.5)/2});  
  //to allow better zooming
  state.cameraObject.near = 1;  
  state.cameraObject.updateProjectionMatrix();
	      
  drawScene(sceneParams);


  function updateMarblePosition(time) {
    var deltaAngle = sceneParams.marbleAngularVelocity * sceneParams.deltaT;
    animationState.marbleAngle += deltaAngle; // in radians
    // if the ball w/ radius R rotates by r radians, the ball rolls R * r units but to the *left*
    animationState.marbleX += -1 * sceneParams.marbleRadius * deltaAngle;
    animationState.marbleZ += 1 * sceneParams.marbleRadius * deltaAngle;
    
    
    marble.position.x = animationState.marbleX;
    marbleCam.position.x = marble.position.x;
    //marble.position.y = animationState.marbleY;
    //marbleCam.position.y = marble.position.y;
    marble.position.z = animationState.marbleZ;
    marbleCam.position.z = marble.position.z;
    marble.rotateX(deltaAngle);
  }

  function animate() 
  {
    requestAnimationFrame( animate );
	render();		
  }

  function updateState() {
    // changes the time and everything in the state that depends on it
    animationState.time += sceneParams.deltaT;
    if (animationState.time < 80) { 
    	//updateMarblePosition(animationState.time);
    }
  }

  function render() 
  {	
    // update marble 
    marble.visible = false;
    updateState();
    marbleCam.updateCubeMap(renderer, scene);
    marble.visible = true;

	//update video
	if (video.readyState === video.HAVE_ENOUGH_DATA) 
	{
		videoImageContext.drawImage(video, 0, 0);
		if (videoTexture) videoTexture.needsUpdate = true;
	}
	renderer.render(scene, state.cameraObject); //re-render the scene using the TW camera
  }

  animate(); //allows video to play

  </script>
  </body>
</html>

